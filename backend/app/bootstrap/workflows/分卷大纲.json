{
  "dsl_version": 1,
  "name": "分卷大纲",
  "nodes": [
    {
      "id": "trigger_start",
      "type": "Trigger.CardSaved",
      "position": {
        "x": -206.74797931453122,
        "y": -114.79718823724181
      },
      "config": {
        "card_type": "分卷大纲"
      },
      "data": {}
    },
    {
      "id": "read",
      "type": "Card.Read",
      "label": "读取分卷大纲",
      "position": {
        "x": -167.91440225446337,
        "y": 266.01853385470054
      },
      "config": {},
      "data": {
        "label": "读取分卷大纲"
      }
    },
    {
      "id": "extract_chars",
      "type": "Data.ExtractPath",
      "label": "提取新角色",
      "position": {
        "x": 243.10780987001783,
        "y": 28.30857402513341
      },
      "config": {
        "path": "content.new_character_cards",
        "default_value": []
      },
      "data": {
        "label": "提取新角色"
      }
    },
    {
      "id": "batch_chars",
      "type": "Card.BatchUpsert",
      "label": "创建角色卡",
      "position": {
        "x": 525.2713638099348,
        "y": 51.28254112507411
      },
      "config": {
        "card_type": "角色卡",
        "title_template": "{item.name}"
      },
      "data": {
        "label": "创建角色卡"
      }
    },
    {
      "id": "extract_scenes",
      "type": "Data.ExtractPath",
      "label": "提取新场景",
      "position": {
        "x": 223.57993783506822,
        "y": 235.06692138503854
      },
      "config": {
        "path": "content.new_scene_cards",
        "default_value": []
      },
      "data": {
        "label": "提取新场景"
      }
    },
    {
      "id": "batch_scenes",
      "type": "Card.BatchUpsert",
      "label": "创建场景卡",
      "position": {
        "x": 498.851301645003,
        "y": 274.12266545493776
      },
      "config": {
        "card_type": "场景卡",
        "title_template": "{item.name}"
      },
      "data": {
        "label": "创建场景卡"
      }
    },
    {
      "id": "gen_stages",
      "type": "Data.GenerateRange",
      "label": "生成阶段列表",
      "position": {
        "x": 221.28254112507415,
        "y": 453.312252294914
      },
      "config": {
        "start": 1,
        "count_source": "content.stage_count",
        "output_field": "index",
        "extra_fields": {
          "volume_number": "content.volume_number"
        }
      },
      "data": {
        "label": "生成阶段列表"
      }
    },
    {
      "id": "batch_stages",
      "type": "Card.BatchUpsert",
      "label": "创建阶段大纲",
      "position": {
        "x": 511.4869835499703,
        "y": 532.5724387897094
      },
      "config": {
        "card_type": "阶段大纲",
        "title_template": "阶段{item.index}",
        "content_template": {
          "stage_number": "{item.index}",
          "volume_number": "{item.volume_number}"
        }
      },
      "data": {
        "label": "创建阶段大纲"
      }
    },
    {
      "id": "wrap_guide",
      "type": "Data.Transform",
      "label": "包装写作指南",
      "position": {
        "x": 199.4572723801304,
        "y": 678.1114881397983
      },
      "config": {
        "expression": "[input.content]"
      },
      "data": {
        "label": "包装写作指南"
      }
    },
    {
      "id": "batch_guide",
      "type": "Card.BatchUpsert",
      "label": "创建写作指南",
      "position": {
        "x": 514.9330786149615,
        "y": 798.724815414487
      },
      "config": {
        "card_type": "写作指南",
        "title_template": "写作指南",
        "content_template": {
          "volume_number": "{item.volume_number}"
        }
      },
      "data": {
        "label": "创建写作指南"
      }
    },
    {
      "id": "clear",
      "type": "Card.Update",
      "label": "清空临时列表",
      "position": {
        "x": 877.505517404671,
        "y": 446.364175589235
      },
      "config": {
        "content_merge": {
          "new_character_cards": [],
          "new_scene_cards": []
        }
      },
      "data": {
        "label": "清空临时列表"
      },
      "dependencies": [
        "batch_chars",
        "batch_scenes"
      ]
    }
  ],
  "edges": [
    {
      "id": "e_tr",
      "source": "trigger_start",
      "target": "read",
      "type": "default"
    },
    {
      "id": "e_c1",
      "source": "read",
      "sourceHandle": "card",
      "target": "extract_chars",
      "targetHandle": "input",
      "type": "default"
    },
    {
      "id": "e_c2",
      "source": "extract_chars",
      "sourceHandle": "output",
      "target": "batch_chars",
      "targetHandle": "items",
      "type": "default"
    },
    {
      "id": "e_c3",
      "source": "read",
      "sourceHandle": "card",
      "target": "batch_chars",
      "targetHandle": "parent_id",
      "type": "default"
    },
    {
      "id": "e_s1",
      "source": "read",
      "sourceHandle": "card",
      "target": "extract_scenes",
      "targetHandle": "input",
      "type": "default"
    },
    {
      "id": "e_s2",
      "source": "extract_scenes",
      "sourceHandle": "output",
      "target": "batch_scenes",
      "targetHandle": "items",
      "type": "default"
    },
    {
      "id": "e_s3",
      "source": "read",
      "sourceHandle": "card",
      "target": "batch_scenes",
      "targetHandle": "parent_id",
      "type": "default"
    },
    {
      "id": "e_st1",
      "source": "read",
      "sourceHandle": "card",
      "target": "gen_stages",
      "targetHandle": "input",
      "type": "default"
    },
    {
      "id": "e_st2",
      "source": "gen_stages",
      "sourceHandle": "output",
      "target": "batch_stages",
      "targetHandle": "items",
      "type": "default"
    },
    {
      "id": "e_st3",
      "source": "read",
      "sourceHandle": "card",
      "target": "batch_stages",
      "targetHandle": "parent_id",
      "type": "default"
    },
    {
      "id": "e_g1",
      "source": "read",
      "sourceHandle": "card",
      "target": "wrap_guide",
      "targetHandle": "input",
      "type": "default"
    },
    {
      "id": "e_g2",
      "source": "wrap_guide",
      "sourceHandle": "output",
      "target": "batch_guide",
      "targetHandle": "items",
      "type": "default"
    },
    {
      "id": "e_g3",
      "source": "read",
      "sourceHandle": "card",
      "target": "batch_guide",
      "targetHandle": "parent_id",
      "type": "default"
    },
    {
      "id": "e_cl1",
      "source": "read",
      "sourceHandle": "card",
      "target": "clear",
      "targetHandle": "card",
      "type": "default"
    }
  ]
}