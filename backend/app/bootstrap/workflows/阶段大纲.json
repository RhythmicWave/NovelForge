{
  "dsl_version": 1,
  "name": "阶段大纲",
  "nodes": [
    {
      "id": "trigger_start",
      "type": "Trigger.CardSaved",
      "position": {
        "x": -42.70628155978652,
        "y": -143.58729437462938
      },
      "config": {
        "card_type": "阶段大纲"
      },
      "data": {}
    },
    {
      "id": "read",
      "type": "Card.Read",
      "label": "读取阶段大纲",
      "position": {
        "x": -92.10031082465902,
        "y": 185.60964900490808
      },
      "config": {},
      "data": {
        "label": "读取阶段大纲"
      }
    },
    {
      "id": "extract_outlines",
      "type": "Data.ExtractPath",
      "label": "提取章节大纲",
      "position": {
        "x": 210.94425593010084,
        "y": -19.936756884742046
      },
      "config": {
        "path": "content.chapter_outline_list",
        "default_value": []
      },
      "data": {
        "label": "提取章节大纲"
      }
    },
    {
      "id": "enrich_outlines",
      "type": "Data.EnrichList",
      "label": "设置章节信息",
      "position": {
        "x": 455.7434917749852,
        "y": 23.71378060514528
      },
      "config": {
        "extra_fields": {
          "volume_number": "content.volume_number",
          "stage_number": "content.stage_number"
        }
      },
      "data": {
        "label": "设置章节信息"
      }
    },
    {
      "id": "batch_outlines",
      "type": "Card.BatchUpsert",
      "label": "创建章节大纲卡",
      "position": {
        "x": 721.7620256296858,
        "y": -104.94043515452265
      },
      "config": {
        "card_type": "章节大纲",
        "title_template": "第{item.chapter_number}章 {item.title}"
      },
      "data": {
        "label": "创建章节大纲卡"
      }
    },
    {
      "id": "batch_chapters",
      "type": "Card.BatchUpsert",
      "label": "创建章节正文卡",
      "position": {
        "x": 764.263864764576,
        "y": 156.9554332452401
      },
      "config": {
        "card_type": "章节正文",
        "title_template": "第{item.chapter_number}章 {item.title}",
        "content_template": {
          "volume_number": "{item.volume_number}",
          "stage_number": "{item.stage_number}",
          "chapter_number": "{item.chapter_number}",
          "title": "第{item.chapter_number}章 {item.title}",
          "content": ""
        }
      },
      "data": {
        "label": "创建章节正文卡"
      }
    },
    {
      "id": "clear",
      "type": "Card.Update",
      "label": "清空大纲列表",
      "position": {
        "x": 1177.9850019092823,
        "y": 378.59097264441
      },
      "config": {
        "content_merge": {
          "chapter_outline_list": []
        }
      },
      "data": {
        "label": "清空大纲列表"
      },
      "dependencies": [
        "batch_outlines",
        "batch_chapters"
      ]
    }
  ],
  "edges": [
    {
      "id": "e_tr",
      "source": "trigger_start",
      "target": "read",
      "type": "default"
    },
    {
      "id": "e_o1",
      "source": "read",
      "sourceHandle": "card",
      "target": "extract_outlines",
      "targetHandle": "input",
      "type": "default"
    },
    {
      "id": "e_o2",
      "source": "extract_outlines",
      "sourceHandle": "output",
      "target": "enrich_outlines",
      "targetHandle": "list",
      "type": "default"
    },
    {
      "id": "e_o2b",
      "source": "read",
      "sourceHandle": "card",
      "target": "enrich_outlines",
      "targetHandle": "context",
      "type": "default"
    },
    {
      "id": "e_o3",
      "source": "enrich_outlines",
      "sourceHandle": "output",
      "target": "batch_outlines",
      "targetHandle": "items",
      "type": "default"
    },
    {
      "id": "e_o4",
      "source": "read",
      "sourceHandle": "card",
      "target": "batch_outlines",
      "targetHandle": "parent_id",
      "type": "default"
    },
    {
      "id": "e_ch2",
      "source": "enrich_outlines",
      "sourceHandle": "output",
      "target": "batch_chapters",
      "targetHandle": "items",
      "type": "default"
    },
    {
      "id": "e_ch3",
      "source": "read",
      "sourceHandle": "card",
      "target": "batch_chapters",
      "targetHandle": "parent_id",
      "type": "default"
    },
    {
      "id": "e_cl1",
      "source": "read",
      "sourceHandle": "card",
      "target": "clear",
      "targetHandle": "card",
      "type": "default"
    }
  ]
}