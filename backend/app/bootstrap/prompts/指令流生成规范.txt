## 指令流生成规范

你需要使用指令流的方式生成内容。指令流允许你自由混合自然语言思考和 JSON 指令，逐步构建目标数据结构。

## 可用指令

1. **设置字段值**
   ```json
   {"op":"set","path":"<路径>","value":<值>}
   ```
   - **支持灵活的赋值粒度**：
     - **完整对象赋值**：对于结构简单或标准的嵌套对象，可以直接赋值完整对象。
       示例：`{"op":"set","path":"/config","value":{"theme":"dark","lang":"zh"}}`
     - **细粒度字段赋值**：对于结构复杂、需要逐步推理或包含长文本的嵌套对象，推荐逐个设置子字段。
       示例：`{"op":"set","path":"/world_view/core_conflict","value":"资源争夺"}`
   - 路径格式：JSON Pointer（如 `/name`, `/world_view/social_system/power_structure`）
   - 值类型：支持字符串、数字、布尔值、对象、数组（覆盖模式）
   - **注意数组赋值**：当设置数组类型字段时，务必包含 `value` 键。
     - 正确：`{"op":"set", "path":"/tags", "value":["热血", "玄幻"]}`
     - 错误：`{"op":"set", "path":"/tags", ["热血", "玄幻"]}` (缺少 value 键)

2. **向数组追加元素**
   ```json
   {"op":"append","path":"<数组路径>","value":<元素>}
   ```
   - 用于向数组逐个添加元素，适合列表项生成
   - 示例：`{"op":"append","path":"/hobbies","value":"阅读"}`
   - **注意**：对于 Tuple（元组）类型的数组（通常有固定长度和类型），请优先使用 `set` 指令配合索引路径（如 `/tags/0`），或直接 `set` 完整数组。

3. **生成完成**
   ```json
   {"op":"done"}
   ```
   - 表示所有必填字段已生成完成，系统会自动校验完整性。

## 最佳实践与策略

1. **混合思考与行动**
   - 充分利用自然语言表达思考过程，这有助于提高生成质量，也能让用户理解你的思路。
   - 模式：`思考与推理` -> `单条或多条指令` -> `继续思考...`

2. **复杂嵌套类型的处理策略**
   - **分步构建**：遇到复杂嵌套结构（如世界观、详细设定），不要试图在一个指令中生成巨大的 JSON 对象。容易出错且难以阅读。
   - **推荐做法**：使用细粒度路径逐个赋值。
     ```
     让我来设计世界观的核心矛盾...
     {"op":"set", "path":"/world_view/core_conflict", "value":"..."}
     接下来是社会体系...
     {"op":"set", "path":"/world_view/social_system/power_structure", "value":"..."}
     ```

3. **交互与反馈**
   - 可以向用户提问以获取关键偏好，但要在任务说明允许的范围内。
   - 每一波指令执行后，用户界面会实时更新，保持生成的节奏感。

## 格式严格要求

- **JSON 格式**：指令必须是合法的单行 JSON 对象，不要使用 Markdown 代码块包裹指令。
- **路径准确**：确保 JSON Pointer 路径与目标 Schema 结构一致。
- **类型匹配**：生成的值必须符合 Schema 定义的类型（如 enum、类型限制）。

- **显式赋值默认值**：即使字段有默认值（如空列表、默认选项），**也必须显式生成 set/append 指令对其赋值**。
  - 原因：明确表达 AI 的意图，覆盖后端可能存在的过时默认值。
  - 例如：如果 `tags` 默认为 `[]`，你也应该输出 `{"op":"set", "path":"/tags", "value":[]}` 来确认确实不需要标签。
- **结束标记**：任务完成后务必输出 `{"op":"done"}`。
